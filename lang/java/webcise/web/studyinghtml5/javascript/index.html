<!DOCTYPE html>
<html lang="ja">
	<head>
		<meta charset="UTF-8" />
		<title>JavaScript(Core and Client)</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="shortcut icon" href="../favicon.ico" />
	</head>
	<body>
		<header role="banner">
			<h1>JavaScript(Core and Client)</h1>
			<p>コア及びクライアントサイドのJavaScriptの練習サイトです。</p>
		</header>

		<main>
			<section>
				<h2>クロージャ</h2>
				<section>
					<h3>thisの扱い</h3>
					<button class="ClosureButton">0</button>
					<button class="ClosureButton">0</button>
					<button class="ClosureButton">0</button>
					<script>
						(function (doc) {
							var btns = doc.querySelectorAll(".ClosureButton");

							for (var i = 0; i < btns.length; i++) {
								btns[i].onclick = (function (x) {
									return function () {
										this.innerHTML = x + 1;
									};
								}(i));

//								btns[i].onclick = (function (x, that) {
//									return function () {
//										that.innerHTML = x + 1;
//									};
//								}(i, btns[i]));
							}
						}(document));
					</script>
				</section>
			</section>
			<section>
				<style scoped="scoped">
					.NewClass {
						color: red;
						font-size: 150%;
					}
				</style>
				<h2>クラスリスト</h2>
				<p id="ClassListSampleElement" class="Hoge Foo Bar">サンプル</p>
				<button id="ToggleClass">Toggle class</button>
				<textarea id="ClassListResult" readonly="readonly" cols="40" rows="5">
				</textarea>
				<script>
					(function (win, doc) {

						var sample = doc.getElementById("ClassListSampleElement"),
							sampleClass = "NewClass",
							toggler = doc.getElementById("ToggleClass"),
							result = doc.getElementById("ClassListResult");

						function addEvent(ele, type, fn, cap) {
							ele.addEventListener(type, fn, cap);
						}

						function init() {
							result.value = "";

							sample.classList.add(sampleClass);

							for (var i = 0; i < sample.classList.length; i++) {
								result.value += sample.classList[i];
								result.value += "\n";
							}

							addEvent(toggler, "click", function () {
								sample.classList.toggle(sampleClass);
							});

							setTimeout(function () {
								sample.classList.remove(sampleClass);
							}, 3000);
						}
						
						init();


					}(window, document));
				</script>
			</section>
			<section>
				<h2>イベントリスナ</h2>
				<textarea id="MultiListenerArea" readonly="readonly" cols="40" rows="5"></textarea>
				<div>
					<p>addEventListenerで同じリスナを何回追加しても1つしか追加されません。</p>
					<p>リスナ追加回数:<input id="MultiListenerSize" type="text" value="5" /></p>
					<button id="MultiListenerSample">イベント発火</button>
					<button id="ClearListenerArea">リセット</button>
				</div>
				<script>
					(function (win, doc) {

						var area = doc.getElementById("MultiListenerArea"),
							lisSiz = doc.getElementById("MultiListenerSize"),
							btn = doc.getElementById("MultiListenerSample"),
							clr = doc.getElementById("ClearListenerArea");

						function outputTime() {
							area.value += new Date().getTime() + "\n";
						}

						var listener = {
							type: "click",
							func: outputTime,
							capture: false
						};

						function getListenerSize() {
							var listenerSize = parseInt(lisSiz.value);
							return !isNaN(listenerSize) ? listenerSize : 0;
						}

						function resetListener() {
							var listenerSize = getListenerSize();

							for (var i = 0; i < listenerSize; i++) {
								btn.addEventListener(listener.type,
									listener.func, listener.capture);
							}
						}

						function clear() {
							area.value = "";

							var listenerSize = getListenerSize();

							for (var i = 0; i < listenerSize; i++) {
								btn.removeEventListener(listener.type,
									listener.func, listener.capture);
							}

							resetListener();
						}

						function init() {
							resetListener();
							clr.addEventListener("click", clear, false);
						}

						init();

					}(window, document));
				</script>
			</section>
		</main>

		<footer role="contentinfo">
			<small>Copyright &copy; 2014 moguonyanko All rights reserved.</small>
		</footer>
	</body>
</html>
