<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8" />
		<title>Navigation Timing</title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<link rel="shortcut icon" href="../../favicon.ico" />
		<style>
		</style>
	</head>
	<body>
		<header role="banner">
			<h1>Navigation Timing</h1>
			<p>Navigation Timing関連の練習サイトです。</p>
		</header>
		<main>
			<section>
				<h2>各種時刻の確認</h2>
				<div id="TimingView">
				</div>
			</section>
			<section>
				<h2>ナビゲーションの種類の確認</h2>
				<div id="NavigationTypeView">
				</div>
			</section>
		</main>

		<script>
			(function (win, doc) {
				"use strict";

				function el(id, node) {
					return (node || doc).getElementById(id);
				}

				var timeView = el("TimingView"),
					naviView = el("NavigationTypeView");

				function formatTimingInfo(info, opt_separator) {
					var txt = [];
					txt.push(info.name);
					txt.push(opt_separator || ":");
					txt.push(info.value);

					var infoValue = txt.join("");

					return infoValue;
				}

				function handleTimingEvent(evt) {
					var timing = win.performance.timing,
						fragment = doc.createDocumentFragment(),
						timeContentId = "TimeContent";
					for (var name in timing) {
						if (typeof timing[name] !== "function") {
							var info = formatTimingInfo({
								name: name,
								value: timing[name]
							});
							var txtNode = doc.createTextNode(info),
								newLine = doc.createElement("br");
							fragment.appendChild(txtNode);
							fragment.appendChild(newLine);
						}
					}

					var cont = doc.createElement("div");
					cont.setAttribute("id", timeContentId);
					cont.appendChild(fragment);
					if (el(timeContentId)) {
						timeView.replaceChild(cont, el(timeContentId));
					} else {
						timeView.appendChild(cont);
					}
				}
				
				function handleNavigationEvent(evt){
					/* @todo implement */
				}

				function addEventListener() {
					win.addEventListener("load", handleTimingEvent, false);
					win.addEventListener("load", handleNavigationEvent, false);
				}

				function init() {
					addEventListener();
				}

				init();

			}(window, document));
		</script>
	</body>
</html>
